# å‰ç«¯è¶…æ—¶é—®é¢˜ä¿®å¤æ–‡æ¡£

## ğŸ› é—®é¢˜æè¿°

**ç°è±¡**ï¼šå‰ç«¯è°ƒç”¨ AI å¯¹è¯æ¥å£æ—¶å“åº”è¶…æ—¶ï¼Œåç«¯å®é™…å·²å®Œæˆå¤„ç†

**åŸå› **ï¼š
1. å‰ç«¯å…¨å±€ Axios è¶…æ—¶è®¾ç½®ä¸º **10 ç§’**ï¼ˆ10000msï¼‰
2. AI å¯¹è¯éœ€è¦æ‰§è¡Œ RAG æ£€ç´¢ + DeepSeek API è°ƒç”¨ï¼Œå®é™…è€—æ—¶å¯èƒ½è¶…è¿‡ 10 ç§’
3. å‰ç«¯è¶…æ—¶åæ–­å¼€è¿æ¥ï¼Œä½†åç«¯ç»§ç»­å¤„ç†ç›´åˆ°å®Œæˆ

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. **æé«˜å…¨å±€è¶…æ—¶æ—¶é—´**

**æ–‡ä»¶**ï¼š`fronted/web-user/src/utils/request.ts`

**ä¿®æ”¹**ï¼š
```typescript
// ä¿®æ”¹å‰
const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || '/api',
  timeout: 10000, // âŒ 10 ç§’å¤ªçŸ­
});

// ä¿®æ”¹å
const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || '/api',
  timeout: 60000, // âœ… å¢åŠ åˆ° 60 ç§’
});
```

**åŸå› **ï¼šå¤§éƒ¨åˆ†æ¥å£åœ¨ 60 ç§’å†…éƒ½èƒ½å®Œæˆï¼Œä½œä¸ºå…¨å±€é»˜è®¤å€¼æ›´åˆç†

---

### 2. **AI å¯¹è¯æ¥å£å•ç‹¬è®¾ç½®æ›´é•¿è¶…æ—¶**

**æ–‡ä»¶**ï¼š`fronted/web-user/src/api/user/ai.ts`

**ä¿®æ”¹**ï¼š
```typescript
// ä¿®æ”¹å‰
export function chatWithAI(data: ChatParams) {
  return request.post<ChatResponse>('/ai/chat', data);
}

// ä¿®æ”¹å
export function chatWithAI(data: ChatParams) {
  // AI å¯¹è¯éœ€è¦è¾ƒé•¿æ—¶é—´ï¼ˆRAG æ£€ç´¢ + DeepSeek ç”Ÿæˆï¼‰ï¼Œå•ç‹¬è®¾ç½® 90 ç§’è¶…æ—¶
  return request.post<ChatResponse>('/ai/chat', data, {
    timeout: 90000 // 90 ç§’
  });
}
```

**åŸå› **ï¼š
- RAG å‘é‡æ£€ç´¢ï¼š~1-2 ç§’
- DeepSeek API è°ƒç”¨ï¼š~5-30 ç§’ï¼ˆå–å†³äºå›ç­”é•¿åº¦ï¼‰
- ç½‘ç»œå»¶è¿Ÿï¼š~1-2 ç§’
- **æ€»è®¡**ï¼šæœ€å¤šå¯èƒ½éœ€è¦ 40 ç§’å·¦å³ï¼Œè®¾ç½® 90 ç§’ç•™è¶³ä½™é‡

---

### 3. **å¢å¼ºè¶…æ—¶é”™è¯¯å¤„ç†**

**æ–‡ä»¶**ï¼š`fronted/web-user/src/utils/request.ts`

**æ–°å¢è¶…æ—¶é”™è¯¯æ£€æµ‹**ï¼š
```typescript
(error) => {
  if (error.response?.status === 401) {
    const userStore = useUserStore();
    userStore.logout();
    return Promise.reject(new Error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•'));
  }
  
  // âœ… æ–°å¢ï¼šå¤„ç†è¶…æ—¶é”™è¯¯
  if (error.code === 'ECONNABORTED' && error.message.includes('timeout')) {
    return Promise.reject(new Error('è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•'));
  }
  
  return Promise.reject(error);
}
```

---

### 4. **ä¼˜åŒ–å‰ç«¯é”™è¯¯æç¤º**

**æ–‡ä»¶**ï¼š`fronted/web-user/src/pages/Home/index.vue`

**ä¿®æ”¹å‰**ï¼š
```typescript
catch (error: any) {
  addChatMessage('assistant', 'æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œè¯·ç¨åå†è¯•ã€‚');
  message.error('å‘é€å¤±è´¥ï¼š' + (error.message || 'æœªçŸ¥é”™è¯¯'));
}
```

**ä¿®æ”¹å**ï¼š
```typescript
catch (error: any) {
  console.error('AI å¯¹è¯é”™è¯¯:', error);
  
  // æ ¹æ®é”™è¯¯ç±»å‹ç»™å‡ºä¸åŒæç¤º
  let errorMessage = 'æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œè¯·ç¨åå†è¯•ã€‚';
  let toastMessage = 'å‘é€å¤±è´¥';
  
  if (error.message && error.message.includes('è¶…æ—¶')) {
    errorMessage = 'æŠ±æ­‰ï¼ŒAI å›å¤ç”¨æ—¶è¾ƒé•¿ï¼Œè¯·ç¨åå†è¯•æˆ–ç®€åŒ–æ‚¨çš„é—®é¢˜ã€‚';
    toastMessage = 'AI å›å¤è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•';
  } else if (error.message) {
    toastMessage = error.message;
  }
  
  addChatMessage('assistant', errorMessage);
  message.error(toastMessage);
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… è¶…æ—¶é”™è¯¯æœ‰ä¸“é—¨çš„å‹å¥½æç¤º
- âœ… å»ºè®®ç”¨æˆ·ç®€åŒ–é—®é¢˜æˆ–ç¨åå†è¯•
- âœ… è®°å½•è¯¦ç»†é”™è¯¯æ—¥å¿—ä¾¿äºè°ƒè¯•

---

## ğŸ“Š è¶…æ—¶æ—¶é—´å¯¹æ¯”

| æ¥å£ç±»å‹ | ä¿®æ”¹å‰ | ä¿®æ”¹å | è¯´æ˜ |
|---------|--------|--------|------|
| **å…¨å±€é»˜è®¤** | 10 ç§’ | 60 ç§’ | é€‚åº”å¤§éƒ¨åˆ†æ¥å£ |
| **AI å¯¹è¯** | 10 ç§’ | 90 ç§’ | RAG + DeepSeek è€—æ—¶è¾ƒé•¿ |
| **æ™®é€š CRUD** | 10 ç§’ | 60 ç§’ | ç»°ç»°æœ‰ä½™ |

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯ 1ï¼šæ­£å¸¸å¯¹è¯ï¼ˆ< 30 ç§’ï¼‰

**æ­¥éª¤**ï¼š
1. æ‰“å¼€å‰ç«¯ AI å®¢æœ
2. è¾“å…¥ï¼š"æ¨èç§‘å¹»å°è¯´"
3. è§‚å¯Ÿå“åº”æ—¶é—´

**é¢„æœŸç»“æœ**ï¼š
- âœ… 10-30 ç§’å†…æ­£å¸¸è¿”å›
- âœ… ä¸å‡ºç°è¶…æ—¶é”™è¯¯

---

### æµ‹è¯•åœºæ™¯ 2ï¼šå¤æ‚é—®é¢˜ï¼ˆ30-60 ç§’ï¼‰

**æ­¥éª¤**ï¼š
1. è¾“å…¥å¤æ‚é—®é¢˜ï¼š"è¯·è¯¦ç»†ä»‹ç»åˆ˜æ…ˆæ¬£çš„æ‰€æœ‰ä½œå“ï¼ŒåŒ…æ‹¬å‡ºç‰ˆæ—¶é—´ã€ä¸»è¦å†…å®¹å’Œè¯„ä»·"
2. è§‚å¯Ÿå“åº”æ—¶é—´

**é¢„æœŸç»“æœ**ï¼š
- âœ… 30-60 ç§’å†…æ­£å¸¸è¿”å›
- âœ… ä¸å‡ºç°è¶…æ—¶é”™è¯¯

---

### æµ‹è¯•åœºæ™¯ 3ï¼šè¶…é•¿å“åº”ï¼ˆ> 60 ç§’ï¼‰

**æ­¥éª¤**ï¼š
1. æ¨¡æ‹Ÿ DeepSeek API å»¶è¿Ÿï¼ˆåç«¯æš‚åœ 70 ç§’ï¼‰
2. è§‚å¯Ÿå‰ç«¯è¡¨ç°

**é¢„æœŸç»“æœ**ï¼š
- âœ… 60 ç§’åæ˜¾ç¤ºå‹å¥½è¶…æ—¶æç¤º
- âœ… ä¸ä¼šæ— é™ç­‰å¾…

---

## ğŸ” æ€§èƒ½åˆ†æ

### æ­£å¸¸æƒ…å†µä¸‹çš„è€—æ—¶åˆ†å¸ƒ

```
ç”¨æˆ·æé—®
  â†“
å‰ç«¯å‘é€è¯·æ±‚ (~100ms)
  â†“
åç«¯æ¥æ”¶è¯·æ±‚ (~50ms)
  â†“
RAG å‘é‡æ£€ç´¢ (~1-2s)
  â”œâ”€ å‘é‡åŒ–ç”¨æˆ·é—®é¢˜ (~500ms)
  â”œâ”€ è®¡ç®—ç›¸ä¼¼åº¦ (~800ms)
  â””â”€ æ’åºè¿‡æ»¤ (~200ms)
  â†“
æ„é€  RAG Prompt (~10ms)
  â†“
è°ƒç”¨ DeepSeek API (~5-30s)
  â”œâ”€ ç½‘ç»œè¯·æ±‚ (~500ms)
  â”œâ”€ AI ç”Ÿæˆå›ç­” (~4-25s)
  â””â”€ è¿”å›å“åº” (~500ms)
  â†“
åç«¯æ ¼å¼åŒ–è¿”å› (~50ms)
  â†“
å‰ç«¯æ¸²æŸ“æ˜¾ç¤º (~100ms)

æ€»è®¡: 7-35 ç§’
```

### è¾¹ç•Œæƒ…å†µ

| åœºæ™¯ | è€—æ—¶ | æ˜¯å¦è¶…æ—¶ï¼ˆæ—§ï¼‰ | æ˜¯å¦è¶…æ—¶ï¼ˆæ–°ï¼‰ |
|------|------|--------------|--------------|
| æœ€å¿«æƒ…å†µ | 5 ç§’ | âŒ | âŒ |
| æ­£å¸¸æƒ…å†µ | 15 ç§’ | âš ï¸ å¯èƒ½ | âŒ |
| å¤æ‚é—®é¢˜ | 35 ç§’ | âœ… å¿…å®š | âŒ |
| ç½‘ç»œå»¶è¿Ÿ | 50 ç§’ | âœ… å¿…å®š | âŒ |
| DeepSeek è¶…æ—¶ | 100 ç§’ | âœ… å¿…å®š | âœ… é¢„æœŸè¶…æ—¶ |

---

## ğŸ“ æœ€ä½³å®è·µå»ºè®®

### 1. **åç«¯ä¼˜åŒ–å»ºè®®**

#### å‘é‡ç¼“å­˜
```java
@Cacheable(value = "embeddings", key = "#text")
public List<Double> embedText(String text) {
    // ç¼“å­˜å¸¸è§é—®é¢˜çš„å‘é‡ï¼Œå‡å°‘ API è°ƒç”¨
}
```

#### å¼‚æ­¥å¤„ç†ï¼ˆæœªæ¥ä¼˜åŒ–ï¼‰
```java
@Async
public CompletableFuture<ChatResponseVO> chatAsync(ChatRequestDTO requestDTO) {
    // å¼‚æ­¥å¤„ç†ï¼Œç«‹å³è¿”å› session ID
    // é€šè¿‡ WebSocket æ¨é€ç»“æœ
}
```

---

### 2. **å‰ç«¯ä¼˜åŒ–å»ºè®®**

#### æ˜¾ç¤ºè¿›åº¦æç¤º
```vue
<div v-if="isAITyping" class="typing-status">
  <n-progress type="circle" :percentage="progress" />
  <p>AI æ­£åœ¨æ€è€ƒä¸­...</p>
</div>
```

#### æµå¼è¾“å‡ºï¼ˆæœªæ¥ä¼˜åŒ–ï¼‰
```typescript
// ä½¿ç”¨ SSE æµå¼æ¥æ”¶ AI å›ç­”
const eventSource = new EventSource('/api/ai/chat/stream');
eventSource.onmessage = (event) => {
  // é€å­—æ˜¾ç¤º AI å›ç­”
  appendAnswer(event.data);
};
```

---

## ğŸ¯ éªŒè¯æ¸…å•

- [x] âœ… å…¨å±€è¶…æ—¶æ—¶é—´æ”¹ä¸º 60 ç§’
- [x] âœ… AI å¯¹è¯è¶…æ—¶æ—¶é—´æ”¹ä¸º 90 ç§’
- [x] âœ… å¢åŠ è¶…æ—¶é”™è¯¯æ£€æµ‹
- [x] âœ… ä¼˜åŒ–è¶…æ—¶é”™è¯¯æç¤º
- [x] âœ… å¿«æ·é—®é¢˜ä¹Ÿåº”ç”¨è¶…æ—¶ä¼˜åŒ–
- [ ] â³ å‰ç«¯æµ‹è¯•éªŒè¯ï¼ˆå¾…ç”¨æˆ·æµ‹è¯•ï¼‰
- [ ] â³ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

---

## ğŸš€ éƒ¨ç½²è¯´æ˜

### å‰ç«¯éƒ¨ç½²

```bash
# 1. é‡æ–°æ„å»ºå‰ç«¯
cd fronted/web-user
npm run build

# 2. éƒ¨ç½²åˆ° Nginx
cp -r dist/* /var/www/html/
```

### éªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥æ„å»ºåçš„ request.ts
grep -n "timeout" dist/assets/index-*.js
# åº”è¯¥çœ‹åˆ° timeout: 60000
```

---

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **è¶…æ—¶æ—¶é—´ä¸è¦è®¾ç½®è¿‡é•¿**
   - å…¨å±€ 60 ç§’å·²ç»è¶³å¤Ÿå¤§éƒ¨åˆ†æ¥å£
   - AI å¯¹è¯ 90 ç§’æ˜¯ä¸Šé™ï¼Œé¿å…æ— é™ç­‰å¾…

2. **è€ƒè™‘ç”¨æˆ·ä½“éªŒ**
   - è¶…è¿‡ 30 ç§’åº”æ˜¾ç¤ºåŠ è½½è¿›åº¦
   - è¶…è¿‡ 60 ç§’åº”æç¤ºç”¨æˆ·

3. **ç›‘æ§å®é™…å“åº”æ—¶é—´**
   - å®šæœŸæ£€æŸ¥ AI å¯¹è¯å¹³å‡å“åº”æ—¶é—´
   - å¦‚æœæ™®éè¶…è¿‡ 60 ç§’ï¼Œè€ƒè™‘åç«¯ä¼˜åŒ–

4. **å¤‡ç”¨æ–¹æ¡ˆ**
   - è¶…æ—¶åå¯ä»¥é‡è¯•ä¸€æ¬¡
   - æˆ–æç¤ºç”¨æˆ·ç®€åŒ–é—®é¢˜

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [RAG åŠŸèƒ½æµ‹è¯•æ–‡æ¡£](./RAG_åŠŸèƒ½æµ‹è¯•æ–‡æ¡£.md)
- [AI å›å¤æ ¼å¼åŒ–ç¤ºä¾‹](./AIå›å¤æ ¼å¼åŒ–ç¤ºä¾‹.md)
- [Embedding API æµ‹è¯•æ–‡æ¡£](./EMBEDDING_API_TEST.md)

---

**æ›´æ–°æ—¶é—´**ï¼š2025-11-29  
**ç‰ˆæœ¬**ï¼šv1.0  
**çŠ¶æ€**ï¼šâœ… å·²ä¿®å¤
