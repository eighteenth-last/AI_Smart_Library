# 图书信息到知识库映射规则设计

## 📋 映射规则概述

将图书信息自动转换为知识库问答对，丰富 AI 客服的知识库内容。

---

## 🎯 映射规则

### 1. 基本图书信息类

#### 规则 1.1：图书简介
**问题模板**：
- "《{书名}》讲的是什么？"
- "《{书名}》的内容简介"
- "介绍一下《{书名}》"

**答案来源**：`book.description`

**示例**：
```
问题: 《三体》讲的是什么？
答案: 地球文明与三体文明的首次接触。在叶文洁的召唤下，三体文明决定入侵地球...
```

---

#### 规则 1.2：作者信息
**问题模板**：
- "《{书名}》是谁写的？"
- "《{书名}》的作者是谁？"

**答案来源**：`author.name` + `author.intro`

**示例**：
```
问题: 《三体》是谁写的？
答案: 《三体》的作者是刘慈欣，中国著名科幻作家，多次获得雨果奖。
```

---

#### 规则 1.3：出版信息
**问题模板**：
- "《{书名}》什么时候出版的？"
- "《{书名}》的出版社是哪家？"
- "《{书名}》的出版信息"

**答案来源**：`book.publisher` + `book.publishYear`

**示例**：
```
问题: 《三体》什么时候出版的？
答案: 《三体》由重庆出版社于2008年出版。
```

---

#### 规则 1.4：ISBN 查询
**问题模板**：
- "《{书名}》的ISBN是多少？"

**答案来源**：`book.isbn`

**示例**：
```
问题: 《三体》的ISBN是多少？
答案: 《三体》的ISBN是9787530216783。
```

---

### 2. 图书馆藏信息类

#### 规则 2.1：库存查询
**问题模板**：
- "《{书名}》还有书吗？"
- "《{书名}》能借吗？"
- "《{书名}》的库存情况"

**答案来源**：`book.availableStock` + `book.totalStock`

**示例**：
```
问题: 《三体》还有书吗？
答案: 目前《三体》有26本可借，总馆藏30本。
```

---

#### 规则 2.2：分类信息
**问题模板**：
- "《{书名}》属于什么分类？"
- "《{书名}》是什么类型的书？"

**答案来源**：`category.name`

**示例**：
```
问题: 《三体》属于什么分类？
答案: 《三体》属于科幻类图书。
```

---

### 3. 读者反馈类

#### 规则 3.1：评分查询
**问题模板**：
- "《{书名}》评分多少？"
- "《{书名}》好看吗？"
- "《{书名}》评价怎么样？"

**答案来源**：`book.averageRating` + `book.reviewCount`

**示例**：
```
问题: 《三体》评分多少？
答案: 《三体》的平均评分是4.8分（基于150条评价），非常受读者欢迎。
```

---

#### 规则 3.2：借阅热度
**问题模板**：
- "《{书名}》受欢迎吗？"
- "《{书名}》借阅量怎么样？"

**答案来源**：`book.borrowCount`

**示例**：
```
问题: 《三体》受欢迎吗？
答案: 《三体》已被借阅300次，是非常受欢迎的图书。
```

---

## 🔧 生成策略

### 条件过滤
只有满足以下条件的图书才生成知识库：
1. ✅ `book.status = 1`（上架状态）
2. ✅ `book.description IS NOT NULL`（有简介）
3. ✅ `book.description 长度 >= 20`（简介不能太短）

### 生成数量
每本图书生成 **3-6 条**知识库问答对：
- 必选（3条）：简介、作者、库存
- 可选（1-3条）：出版信息、分类、评分（根据数据完整性）

### 知识库分类
所有自动生成的知识库归类为：
- `category = "图书信息"`
- `source = "auto_generated"`
- `isPublic = 1`（公开可见）

---

## 📊 数据映射表

| 图书字段 | 问题类型 | 必需 | 优先级 |
|---------|---------|-----|-------|
| `title` | 所有问题 | ✅ | 高 |
| `description` | 简介类 | ✅ | 高 |
| `authorName` | 作者类 | ✅ | 高 |
| `availableStock` | 库存类 | ✅ | 高 |
| `publisher` | 出版信息 | ⭕ | 中 |
| `publishYear` | 出版信息 | ⭕ | 中 |
| `isbn` | ISBN查询 | ⭕ | 低 |
| `categoryName` | 分类查询 | ⭕ | 中 |
| `averageRating` | 评分查询 | ⭕ | 中 |
| `borrowCount` | 热度查询 | ⭕ | 低 |

---

## 🎨 生成示例

### 输入：图书数据
```json
{
  "bookId": 1,
  "isbn": "9787530216783",
  "title": "三体",
  "authorName": "刘慈欣",
  "categoryName": "科幻",
  "publisher": "重庆出版社",
  "publishYear": 2008,
  "description": "地球文明与三体文明的首次接触。在叶文洁的召唤下...",
  "totalStock": 30,
  "availableStock": 26,
  "averageRating": 4.8,
  "reviewCount": 150,
  "borrowCount": 300
}
```

### 输出：知识库问答对
```json
[
  {
    "question": "《三体》讲的是什么？",
    "answer": "《三体》讲述了地球文明与三体文明的首次接触。在叶文洁的召唤下...",
    "category": "图书信息",
    "source": "auto_generated"
  },
  {
    "question": "《三体》是谁写的？",
    "answer": "《三体》的作者是刘慈欣，中国著名科幻作家。",
    "category": "图书信息",
    "source": "auto_generated"
  },
  {
    "question": "《三体》还有书吗？",
    "answer": "目前《三体》有26本可借，总馆藏30本。",
    "category": "图书信息",
    "source": "auto_generated"
  },
  {
    "question": "《三体》什么时候出版的？",
    "answer": "《三体》由重庆出版社于2008年出版。",
    "category": "图书信息",
    "source": "auto_generated"
  },
  {
    "question": "《三体》属于什么分类？",
    "answer": "《三体》属于科幻类图书。",
    "category": "图书信息",
    "source": "auto_generated"
  },
  {
    "question": "《三体》评分多少？",
    "answer": "《三体》的平均评分是4.8分（基于150条评价），非常受读者欢迎。",
    "category": "图书信息",
    "source": "auto_generated"
  }
]
```

---

## ⚙️ 实现要点

### 1. 去重机制
- 检查知识库中是否已存在相同问题
- 根据 `book_id` 关联，避免重复生成

### 2. 更新策略
- 图书信息更新时，同步更新相关知识库
- 图书下架时，标记相关知识库为"已过期"

### 3. 向量生成
- 生成知识库后，自动调用向量服务生成 embedding
- 存入 `knowledge_base.embedding` 字段

---

## 📝 总结

**优势**：
- ✅ 自动生成，减少人工维护成本
- ✅ 实时更新，保证信息准确性
- ✅ 丰富知识库，提升 AI 客服能力
- ✅ 结构化数据，易于管理

**适用场景**：
- 📚 图书基本信息查询
- 📊 馆藏状态查询
- ⭐ 图书推荐依据

**下一步**：
- 实现自动生成服务
- 实现定时同步任务
- 实现向量缓存更新
