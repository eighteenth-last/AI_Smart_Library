# 知识库导入/导出功能文档

## 📚 功能概述

知识库导入/导出功能允许管理员通过 Excel 或 CSV 文件批量管理知识库问答对数据。

---

## ✨ 功能特性

### 1. 批量导入
- ✅ 支持 Excel 格式（.xlsx, .xls）
- ✅ 支持 CSV 格式（.csv）
- ✅ 自动数据校验
- ✅ 重复检测（基于问题）
- ✅ 详细错误报告

### 2. 批量导出
- ✅ 导出为 Excel 格式
- ✅ 导出为 CSV 格式
- ✅ 支持按分类筛选
- ✅ 自动格式化

---

## 📋 导入文件格式

### Excel 格式

**标题行**（第1行）：
| 问题 | 答案 | 分类 | 来源 | 是否公开 |
|------|------|------|------|----------|

**数据行示例**：
| 问题 | 答案 | 分类 | 来源 | 是否公开 |
|------|------|------|------|----------|
| 图书馆开放时间是什么？ | 图书馆周一至周日 8:00-22:00 开放 | 图书馆业务 | system | 公开 |
| 如何借阅图书？ | 凭借书证在自助借还机上办理借阅手续 | 图书馆业务 | system | 1 |

### CSV 格式

**标题行**（第1行）：
```
question,answer,category,source,is_public
```

**数据行示例**：
```
图书馆开放时间是什么？,图书馆周一至周日 8:00-22:00 开放,图书馆业务,system,1
如何借阅图书？,凭借书证在自助借还机上办理借阅手续,图书馆业务,system,1
```

---

## 📝 字段说明

| 字段名 | 类型 | 必填 | 长度限制 | 说明 |
|--------|------|------|----------|------|
| **问题** (question) | 文本 | ✅ 是 | 最大 500 字符 | 知识库问题 |
| **答案** (answer) | 文本 | ✅ 是 | 最大 5000 字符 | 知识库答案 |
| **分类** (category) | 文本 | ❌ 否 | 最大 50 字符 | 分类：图书馆业务/作者问答/图书推荐 |
| **来源** (source) | 文本 | ❌ 否 | 最大 100 字符 | 来源：system/admin/author |
| **是否公开** (is_public) | 整数/文本 | ❌ 否 | - | 1/公开/public = 公开<br>0/私有/private = 私有<br>默认：公开 |

---

## 🔍 数据校验规则

### 必填字段
- ❌ 问题不能为空
- ❌ 答案不能为空

### 长度限制
- ❌ 问题长度不能超过 500 字符
- ❌ 答案长度不能超过 5000 字符
- ❌ 分类长度不能超过 50 字符
- ❌ 来源长度不能超过 100 字符

### 重复检测
- ❌ 问题已存在于数据库中

---

## 🚀 使用步骤

### 导入流程

1. **准备数据**
   - 下载导入模板（可先导出现有数据作为参考）
   - 按照格式填写数据
   - 检查必填字段和长度限制

2. **上传文件**
   - 点击"批量导入"按钮
   - 选择 Excel 或 CSV 文件
   - 等待上传和解析

3. **查看结果**
   - 查看导入统计（总计/成功/失败）
   - 如有失败记录，查看错误详情
   - 根据错误提示修正数据后重新导入

### 导出流程

1. **选择分类**（可选）
   - 留空：导出所有数据
   - 选择分类：导出指定分类的数据

2. **选择格式**
   - 点击"导出数据"下拉菜单
   - 选择"导出为 Excel"或"导出为 CSV"

3. **下载文件**
   - 文件自动下载到浏览器默认下载目录
   - 文件名格式：`知识库导出_20251129_153000.xlsx`

---

## 💡 最佳实践

### 导入前
1. ✅ 先下载现有数据作为模板参考
2. ✅ 使用 Excel 打开模板，确保格式正确
3. ✅ 分批导入大量数据（建议每批不超过 1000 条）
4. ✅ 备份原有数据（可先导出）

### 导入时
1. ✅ 检查文件编码为 UTF-8（避免中文乱码）
2. ✅ 确保问题唯一性（避免重复）
3. ✅ 填写有意义的分类（便于管理）
4. ✅ 合理设置公开/私有（保护敏感信息）

### 导入后
1. ✅ 检查导入结果报告
2. ✅ 修正失败记录后重新导入
3. ✅ 在列表中验证数据正确性
4. ✅ 测试新导入的知识库是否生效

---

## ⚠️ 常见错误

### 1. "文件格式不支持"
**原因**：上传的文件不是 .xlsx、.xls 或 .csv 格式  
**解决**：使用 Excel 或文本编辑器保存为正确格式

### 2. "问题不能为空"
**原因**：某行的问题字段为空  
**解决**：检查错误详情中的行号，补充问题内容

### 3. "问题已存在"
**原因**：数据库中已有相同问题  
**解决**：修改问题内容使其唯一，或删除重复行

### 4. "答案长度超过限制"
**原因**：答案内容超过 5000 字符  
**解决**：精简答案内容，或拆分为多个问答对

### 5. "中文乱码"
**原因**：CSV 文件编码不是 UTF-8  
**解决**：使用支持 UTF-8 的编辑器保存文件（如 VS Code）

---

## 🔧 API 接口

### 批量导入
```http
POST /api/ai/admin/knowledge/import
Content-Type: multipart/form-data

file: <binary>
```

**响应示例**：
```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "totalCount": 100,
    "successCount": 95,
    "failedCount": 5,
    "errorDetails": [
      {
        "rowNumber": 10,
        "question": "图书馆在哪里？",
        "errorMessage": "问题已存在"
      }
    ]
  }
}
```

### 导出 Excel
```http
GET /api/ai/admin/knowledge/export/excel?category=图书馆业务
```

### 导出 CSV
```http
GET /api/ai/admin/knowledge/export/csv?category=图书馆业务
```

---

## 📊 导入结果说明

导入完成后会显示：
- **总计**：文件中的总记录数
- **成功**：成功导入的记录数
- **失败**：导入失败的记录数
- **错误详情**：每条失败记录的行号、问题内容和错误原因

---

## 🎯 示例数据

### 图书馆业务类
```
问题：图书馆开放时间是什么？
答案：图书馆周一至周日 8:00-22:00 开放，节假日开放时间请关注官网通知。
分类：图书馆业务
来源：system
是否公开：1
```

### 作者问答类
```
问题：如何成为签约作者？
答案：您需要发布至少3篇优质作品，且累计阅读量超过10000次，即可申请成为签约作者。
分类：作者问答
来源：admin
是否公开：1
```

### 图书推荐类
```
问题：有哪些经典科幻小说推荐？
答案：推荐《三体》《银河帝国》《沙丘》等经典科幻作品，这些书籍在本馆均有馆藏。
分类：图书推荐
来源：system
是否公开：1
```

---

## 📞 技术支持

如遇到问题，请联系：
- 📧 Email: admin@library.com
- 📱 电话: 123-456-7890
- 💬 在线客服: 工作日 9:00-18:00

---

**文档版本**: v1.0  
**更新时间**: 2025-11-29  
**作者**: AI Smart Library Team
